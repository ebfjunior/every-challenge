# Tasks API — Take-Home Assignment

A minimal service built with **Node.js (Express)**, **TypeScript**, **Prisma + PostgreSQL**, **Docker**, **Zod** for schema validation, and **Pino** for structured logging.

---

## Quick Start

Make sure Docker is running, then:

```bash
make setup   # install deps, generate Prisma client, run migrations, seed DB
make dev     # start the dev stack (API + Postgres)
```

The API runs at **http://localhost:3000**

---

## Prerequisites

- **Docker** & **Docker Compose**
- **GNU Make**

> No local Node/DB setup required — everything runs in containers.

---

## Architecture

The code follows a layered approach:

```
[ Express Routers / Controllers ]  <-- REST, HTTP concerns, Zod request validation, error mapping
                |
           (Use Cases)
      business/application logic
     - orchestrates data flow
     - calls repositories
     - throws domain errors
                |
          (Repositories)
      data-access via Prisma ORM
                |
             Postgres

(Models / DTOs)
- DTOs translate raw DB shapes <-> domain objects used by use cases
```

- **Repositories:** all Prisma queries live here.
- **Models (DTOs):** map database records to domain objects the app uses.
- **Use Cases:** hold business rules and control flow; surface domain errors for controllers to map to HTTP.
- **Controllers/Routers:** Express layer; wire routes to use cases and shape HTTP responses.

---

## Validation (Zod)

- **Where:** validation is performed at the **controller** level.
- **Current:** request **bodies** are validated with Zod before hitting use cases. Invalid payloads return **400** with structured error details.

---

## Authentication 

For the time-boxed assignment, the API checks for an `X-User-Id` header to identify the caller.

---

## Authorization

Authorization is enforced in the **use case layer** by ensuring all task operations are filtered by the `userId` of the authenticated caller. The use cases only operate on data that matches the provided user id, preventing access to other users' tasks.


## Error Handling (use cases)

- **Current:** controllers map thrown errors to HTTP responses.
- **Planned improvements:**
  - Define **typed domain errors** (e.g., `NotFoundError`, `ConflictError`, `ValidationError`) in use cases.
  - A simple **error mapper** middleware converts domain errors → `{status, code, message}` consistently.
  - Encourage `Result`-style returns where appropriate for clearer control flow in complex operations.

---

## Logging & Audit

- **Current:** structured JSON logs via **Pino**; request correlation IDs via `X-Request-Id`; access logs with latency and status;

---

## API Usage

- Import **`insomnia/every-tasks.json`** into Insomnia (File → Import → From File) to try endpoints quickly.

---

## Testing

- **Unit/feature tests:** **Vitest**
- **Integration (HTTP) tests:** **SuperTest**

Common commands (if wired in Makefile/package scripts):

```bash
make test
# or
docker compose run api npm test
```

---

## Time & Scope Notes

- **Time spent:** ~**5 hours** (kept close to the requested time box).
- **Scope:** Standard implementation of the asked requirements without extra features beyond scope.

---

## Future Work

- Validate path and query parameters with Zod and centralize reusable validators (UUIDs, enums, pagination).
- Strengthen authentication by validating user IDs against the database or integrating a real auth provider.
- Add optimistic concurrency control with a `version` field to avoid lost updates.
- Add pagination to `GET /api/tasks` with safe bounds and cursor support.
- Expand error handling with typed domain errors and a middleware to map them to consistent HTTP responses.
- Extend logging/auditing with a dedicated append-only audit log and separated channels for app vs audit events.

---

## AI Usage Disclosure

The assignment requested **not** to use AI for implementation, which I respected with the following exceptions:

- **Prisma seed file** — generated with AI.  
- **This README** — generated by AI via voice notes.  
- **`insomnia/every-tasks.json`** — generated with AI.